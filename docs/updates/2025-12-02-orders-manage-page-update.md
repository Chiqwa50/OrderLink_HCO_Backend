# تحديث صفحة إدارة الطلبيات

**التاريخ:** 2025-12-02  
**الملف:** `/frontend/src/app/(dashboard-layout)/orders/manage/page.tsx`

## الملخص

تم تحديث صفحة إدارة الطلبيات لتكون مشابهة لصفحة إدارة المواد مع تحسينات كبيرة في واجهة المستخدم والوظائف.

## التغييرات الرئيسية

### 1. نظام Pagination

- **العرض الافتراضي:** 10 طلبيات في الصفحة
- **خيارات العرض:** 10, 20, 30, 40, 50, 100 عنصر
- **التنقل:** أزرار السابق/التالي مع عرض رقم الصفحة الحالية
- **معلومات العرض:** عرض "من X إلى Y من Z طلبية"

### 2. إزالة الفلترة من الأعمدة

- تم إزالة نظام الفلترة المعقد من رؤوس الأعمدة
- تم الاحتفاظ بشريط البحث العام فقط
- البحث يعمل على: رقم الطلبية، اسم القسم، اسم المستودع

### 3. عمود الإجراءات المحسّن

تم تحويل عمود الإجراءات من أزرار منفصلة إلى قائمة منسدلة (Dropdown Menu) باستخدام أيقونة النقاط الثلاث (`MoreHorizontal`).

#### الإجراءات المتاحة:

1. **عرض التفاصيل** (Eye icon)
   - متاح لجميع الطلبات
   
2. **تحميل PDF** (Download icon)
   - متاح لجميع الطلبات

3. **تعديل** (Edit icon)
   - متاح فقط للطلبات التي ليست في حالة "مسلّم" أو "مرفوض"

4. **قبول الطلب** (CheckCircle icon) - جديد
   - متاح فقط للطلبات في حالة "PENDING"
   - يظهر حوار تأكيد قبل التنفيذ
   - يحدث حالة الطلب إلى "APPROVED"
   - لون أخضر للدلالة على الإيجابية

5. **رفض الطلب** (XCircle icon) - جديد
   - متاح فقط للطلبات في حالة "PENDING"
   - يظهر حوار تأكيد قبل التنفيذ
   - يحدث حالة الطلب إلى "REJECTED"
   - لون برتقالي للدلالة على التحذير

6. **حذف** (Trash2 icon)
   - متاح فقط للطلبات في حالة "PENDING"
   - يظهر حوار تأكيد قبل التنفيذ
   - لون أحمر للدلالة على الخطورة

### 4. حوارات التأكيد

تم إضافة ثلاثة حوارات تأكيد منفصلة:

#### حوار حذف الطلب
```typescript
- العنوان: "هل أنت متأكد من حذف الطلب؟"
- الوصف: "سيتم حذف الطلبية رقم X نهائياً. لا يمكن التراجع عن هذا الإجراء."
- الأزرار: إلغاء، حذف (أحمر)
```

#### حوار قبول الطلب
```typescript
- العنوان: "تأكيد قبول الطلب"
- الوصف: "هل أنت متأكد من قبول الطلبية رقم X؟ سيتم تحديث حالة الطلب إلى 'مقبول'."
- الأزرار: إلغاء، قبول الطلب (أخضر)
```

#### حوار رفض الطلب
```typescript
- العنوان: "تأكيد رفض الطلب"
- الوصف: "هل أنت متأكد من رفض الطلبية رقم X؟ سيتم تحديث حالة الطلب إلى 'مرفوض'."
- الأزرار: إلغاء، رفض الطلب (برتقالي)
```

### 5. تحسينات الأداء

- استخدام `useMemo` لحساب الإحصائيات
- استخدام `useMemo` لفلترة الطلبيات
- استخدام `useMemo` لحساب الـ pagination
- استخدام `useCallback` لمعالجات الأحداث

### 6. حالات التحميل

- شاشة تحميل عند تغيير حجم الصفحة
- مؤشرات تحميل في أزرار التأكيد
- تعطيل الأزرار أثناء العمليات

## البنية الجديدة

```typescript
State Management:
- orders: Order[]
- isLoading: boolean
- error: string | null
- searchTerm: string
- selectedOrder: Order | null
- showEditDialog: boolean
- currentPage: number
- pageSize: number
- isChangingPageSize: boolean
- orderToDelete: Order | null
- isDeleting: boolean
- orderToApprove: Order | null
- orderToReject: Order | null
- isUpdatingStatus: boolean
```

## الوظائف الجديدة

```typescript
handleApproveClick(order: Order): void
confirmApprove(): Promise<void>
handleRejectClick(order: Order): void
confirmReject(): Promise<void>
handlePageChange(page: number): void
handlePageSizeChange(size: number): void
```

## التكامل مع الـ Backend

يستخدم الصفحة الوظائف التالية من `orderService`:

- `getOrders()` - جلب جميع الطلبيات
- `updateOrderStatus(orderId, { status })` - تحديث حالة الطلب
- `updateOrder(orderId, updates)` - تعديل الطلب
- `deleteOrder(orderId)` - حذف الطلب

## الصلاحيات

جميع الإجراءات متاحة للمدير (Admin) فقط:
- قبول الطلبات
- رفض الطلبات
- تعديل الطلبات
- حذف الطلبات

## تجربة المستخدم

### قبل التحديث:
- عرض جميع الطلبيات في صفحة واحدة
- فلاتر معقدة في الأعمدة
- أزرار إجراءات منفصلة تأخذ مساحة كبيرة
- عدم وجود إمكانية قبول/رفض مباشرة

### بعد التحديث:
- عرض 10 طلبيات فقط مع إمكانية التنقل
- بحث بسيط وفعال
- قائمة إجراءات منظمة ومدمجة
- إمكانية قبول/رفض الطلبات بسهولة
- حوارات تأكيد واضحة لكل إجراء

## الملاحظات

1. تم الحفاظ على جميع الوظائف السابقة
2. تم تحسين الأداء باستخدام React Hooks
3. تم تحسين تجربة المستخدم بشكل كبير
4. الكود أكثر تنظيماً وسهولة في الصيانة
5. متوافق تماماً مع نظام الألوان والتصميم الحالي

## الملفات المرتبطة

- `/frontend/src/components/orders/edit-order-dialog.tsx`
- `/frontend/src/components/orders/order-status-badge.tsx`
- `/frontend/src/components/ui/data-table-pagination.tsx`
- `/frontend/src/services/order-service.ts`
- `/frontend/src/lib/date-utils.ts`
