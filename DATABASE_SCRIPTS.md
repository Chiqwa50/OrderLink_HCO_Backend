# Database Migration Scripts

هذا المجلد يحتوي على سكريبتات للتعامل مع قاعدة البيانات.

## الملفات

### 1. `db-push.sh` (موصى به للتطوير)
يقوم بمزامنة schema مع قاعدة البيانات مباشرة بدون إنشاء ملفات migration.

**الاستخدام:**
```bash
./db-push.sh
```

**متى تستخدمه:**
- عند تعديل schema أثناء التطوير
- عند إضافة حقول جديدة
- عند تعديل enums
- أسرع من migrations

---

### 2. `migrate.sh` (للإنتاج)
يقوم بإنشاء migration files وتطبيقها على قاعدة البيانات.

**الاستخدام:**
```bash
./migrate.sh <اسم_الهجرة>
```

**مثال:**
```bash
./migrate.sh add_approval_actions
```

**متى تستخدمه:**
- في بيئة الإنتاج
- عندما تريد تتبع التغييرات
- عندما تريد rollback

---

## ملاحظات مهمة

1. **نص الاتصال:**
   - السكريبتات تستخدم نص الاتصال المباشر (port 5432)
   - التطبيق يستخدم نص الاتصال من `.env` (port 6543 - pooler)

2. **بعد تشغيل السكريبت:**
   - يجب إعادة تشغيل الـ backend
   - اضغط Ctrl+C في terminal الـ backend
   - ثم شغل `npm run dev` مرة أخرى

3. **الفرق بين db-push و migrate:**
   - `db-push`: سريع، لا ينشئ ملفات، مناسب للتطوير
   - `migrate`: ينشئ ملفات، يتتبع التغييرات، مناسب للإنتاج

---

## أمثلة شائعة

### إضافة enum جديد
1. عدل `schema.prisma`
2. شغل `./db-push.sh`
3. أعد تشغيل الـ backend

### إضافة جدول جديد
1. عدل `schema.prisma`
2. شغل `./db-push.sh`
3. أعد تشغيل الـ backend

### تعديل علاقات
1. عدل `schema.prisma`
2. شغل `./db-push.sh`
3. أعد تشغيل الـ backend
